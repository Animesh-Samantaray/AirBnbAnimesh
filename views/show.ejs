<% layout('/layout/boiler') %>

<div class="container mt-5 mb-5 px-3 px-md-5">

  <!-- Title -->
  <h1 class="fw-bold display-5 text-center mb-4"><%= list.title %></h1>

  <!-- Image -->
  <div class="mb-4">
    <img src="<%= list.image %>" alt="Listing Image"
         class="w-100 rounded-4 shadow-sm" style="max-height: 550px; object-fit: cover;">
  </div>

  <!-- Info Section -->
  <div class="row">
    <div class="col-md-8">
      <p class="fs-5 text-muted"><%= list.owner.username %></p>
      <p class="fs-5 text-muted"><%= list.description %></p>
    </div>
    <div class="col-md-4 text-md-end mt-3 mt-md-0">
      <p class="fs-4 fw-semibold text-success">
        â‚¹ <%= list.formattedPrice || list.price %>
      </p>
      <p class="text-secondary">ğŸ“ <%= list.location %>, <%= list.country %></p>
    </div>
  </div>

  <!-- Actions -->
  <div class="d-flex flex-column flex-md-row justify-content-center gap-3 mt-5">
    <a href="/listing/<%= list._id %>/edit" class="btn btn-dark px-4 py-2">
      âœï¸ Edit this listing
    </a>

    <form action="/listing/<%= list._id %>?_method=DELETE" method="POST"
          onsubmit="return confirm('Are you sure you want to delete this listing?')">
      <button type="submit" class="btn btn-outline-danger px-4 py-2">
        ğŸ—‘ï¸ Delete listing
      </button>
    </form>
  </div>

  <hr>

  <!-- Review Form -->
  <div class="mt-5">
    <form action="/listing/<%= list._id %>/review" method="post" novalidate class="needs-validation">
      <div class="mb-3">
        <h4>Leave a Rating</h4>
        <label for="rating" class="form-label">Rating</label>
        <input type="range" min="1" max="5" name="review[rating]" id="rating" class="form-range">
      </div>

      <div class="mb-3">
        <h4>Drop your comment</h4>
        <label for="comment" class="form-label">Comment</label>
        <textarea name="review[comments]" id="comment" rows="6" class="form-control"></textarea>
      </div>

      <button type="submit" class="btn btn-success px-4 py-2">Submit</button>
    </form>
  </div>

  <hr>

  <!-- Reviews Section -->
  <div class="mt-4">
    <h3 class="mb-3">Reviews</h3>
    <% if (list.reviews && list.reviews.length > 0) { %>
      <% list.reviews.forEach(r => { %>
        <div class="card mb-3 p-3 shadow-sm">
          <p class="mb-1"><strong>â­ Rating:</strong> <%= r.rating %></p>
          <p class="mb-0"><%= r.comments %></p>
        </div>
      <% }) %>
    <% } else { %>
      <p class="text-muted">No reviews yet. Be the first to leave one!</p>
    <% } %>
  </div>

</div>
